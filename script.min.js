const weightNames={100:"Thin",200:"Extra-Light",300:"Light",400:"Regular",500:"Medium",600:"Semi-Bold",700:"Bold",800:"Extra-Bold",900:"Black"};function wrapSelector(e){return"html"===(e=e.trim()).toLowerCase()?"html.previewerForGoogleFonts":"html.previewerForGoogleFonts "+e}function buildCustomCss(e,t,n,o,a,s,l,i,r){let c=`${e}{font-family:'${t}' !important; font-weight:${n} !important;`;return l?c+=` font-style:${l} !important;`:o&&""!==o.trim()&&"null"!==o&&(c+=` font-style:${o} !important;`),a&&""!==a.trim()&&(c+=` font-size:${a}${s} !important;`),i&&(c+=` text-decoration:${i} !important;`),r&&(c+=` text-transform:${r} !important;`),c+="}",c}let fullListUl=null,fontObserver=null,selectedFonts={},selectedCSS={},currentDomain="",restoredState=null;function getStyleId(e){return"previewer-font-"+e.replace(/[^a-z0-9]/gi,"_")}function reapplySelectedFonts(){for(const e in selectedFonts)if(selectedFonts.hasOwnProperty(e)){const{fontFamily:t,fontWeight:n,fontStyle:o,fontSize:a,fontSizeUnit:s,extraFontStyle:l,textDecoration:i,textTransform:r}=selectedFonts[e],c="italic"===o||"italic"===l?1:0,d="https://fonts.googleapis.com/css2?family="+encodeURIComponent(t)+":ital,wght@"+c+","+n;fetch(d).then((e=>e.text())).then((c=>{const d=c+buildCustomCss(wrapSelector(e),t,n,o,a,s,l,i,r);chrome.tabs.query({active:!0,currentWindow:!0},(t=>{const n=t[0],o=getStyleId(e);chrome.scripting.executeScript({target:{tabId:n.id},func:(e,t)=>{let n=document.getElementById(t);n||(n=document.createElement("style"),n.id=t,document.head.appendChild(n)),n.textContent=e,document.documentElement.classList.add("previewerForGoogleFonts")},args:[d,o]})}))})).catch((e=>{console.error(e)}))}}function removeInjectedFontStyle(e,t){chrome.tabs.query({active:!0,currentWindow:!0},(n=>{const o=n[0],a=getStyleId(e);chrome.scripting.executeScript({target:{tabId:o.id},func:e=>{const t=document.getElementById(e);t&&(t.remove(),document.documentElement.offsetHeight)},args:[a]},t)}))}function toTitleCase(e){return e.replace(/\w\S*/g,(e=>e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()))}function setStorageData(e,t){chrome.storage.local.set({[e]:t})}function buildVariantsString(e){const t=[];return e.forEach((e=>{const n=e.includes("italic"),o=e.replace(/\D/g,"")||"400",a=n?"1":"0";t.push(`${a},${o}`)})),t.join(";")}function getTopVisibleFontIndex(){const e=document.querySelector("#findSection .scroller.filterable");if(!e)return null;const t=e.getBoundingClientRect(),n=e.querySelectorAll("li.parent");for(const e of n){if(e.getBoundingClientRect().bottom>t.top)return e.getAttribute("data-font-index")}return null}function updatePersistentState(){const e={};e.searchInput=document.getElementById("searchInput").value,e.categoryFilter=document.getElementById("categoryFilter").value,e.weightFilter=document.getElementById("weightFilter").value,e.selectorInput=document.getElementById("selectorInput").value,e.topVisibleFont=getTopVisibleFontIndex(),chrome.storage.local.set({["popupState_"+currentDomain]:e})}function updateFilter(){return showPreloader(),new Promise((e=>{requestAnimationFrame((()=>{performFiltering((document.getElementById("searchInput").value||"").toLowerCase(),document.getElementById("categoryFilter").value||"none",document.getElementById("weightFilter").value||"none"),requestAnimationFrame((()=>{e()}))}))}))}function restoreTopFont(){return new Promise((e=>{if(restoredState&&restoredState.topVisibleFont){const e=fullListUl.querySelector(`li.parent[data-font-index="${restoredState.topVisibleFont}"]`);e&&e.scrollIntoView({block:"start"})}requestAnimationFrame((()=>{restoredState=null,e()}))}))}function runFilterChain(){updateFilter().then((()=>restoredState&&restoredState.topVisibleFont?restoreTopFont():Promise.resolve())).then((()=>{hidePreloader(),updatePersistentState()}))}function updateBadgeCounts(){chrome.storage.local.get("selectedFonts_"+currentDomain,(e=>{var t=e["selectedFonts_"+currentDomain]||{};updateBadge("#tabSelected",Object.keys(t).length)})),chrome.storage.local.get("favorite-fonts",(e=>{updateBadge("#tabFavorites",(e["favorite-fonts"]||[]).length)}))}function updateBadge(e,t){var n,o=document.querySelector(e);0===t?(n=o.querySelector(".badge"))&&n.remove():((n=o.querySelector(".badge"))||((n=document.createElement("span")).className="badge",o.appendChild(n)),n.textContent=t)}function performFiltering(e,t,n){fullListUl.querySelectorAll("li.parent").forEach((o=>{const a=o.getAttribute("data-lowercase")||"",s=o.getAttribute("data-category")||"",l=o.getAttribute("data-variant-weights")||"",i=""===e||a.includes(e),r="none"===t||s===t,c="none"===n||l.includes(n);if(i&&r&&c)if(o.style.display="","none"!==n){o.classList.add("open");const e=o.querySelector("div.variants");e&&(e.classList.contains("loaded")||e.innerHTML.trim()||!e.getAttribute("data-variants")||loadVariantStyles(o),e.querySelectorAll("li").forEach((e=>{e.getAttribute("data-font-weight")===n?e.style.display="":e.style.display="none"})))}else o.classList.remove("open");else o.style.display="none"}))}function showPreloader(){const e=document.querySelector(".scroller.filterable");if(e){let t=document.getElementById("preloader-overlay");t||(t=document.createElement("div"),t.id="preloader-overlay",t.innerHTML="<div class='spinner'></div>",e.appendChild(t))}}function hidePreloader(){const e=document.getElementById("preloader-overlay");e&&e.remove()}function RequestFontsJSON(){fetch("https://www.googleapis.com/webfonts/v1/webfonts?key=AIzaSyCbTrNnpZwQAQhL4mFvPHLzDVaGBTh1IWE").then((e=>e.json())).then((e=>{console.log("Loaded font JSON from Google"),loadPage(e)})).catch((e=>console.error(e)))}function loadPage(e){chrome.storage.local.get(["favorite-fonts","selectedFonts_"+currentDomain],(t=>{if(t){const n=t["favorite-fonts"]||[],o=t["selectedFonts_"+currentDomain]||{},a=Object.values(o).map((e=>e.fontFamily));new Set([...n,...a]).forEach((t=>{const n=e.items.find((e=>e.family===t));if(n){const e=buildVariantsString(n.variants),o="https://fonts.googleapis.com/css2?family="+encodeURIComponent(n.family)+":ital,wght@"+e+"&display=swap",a=document.createElement("link");a.rel="stylesheet",a.href=o,a.setAttribute("data-immediate",t),document.head.appendChild(a)}}))}}));let t="";const n="https://fonts.googleapis.com/css2";let o=1,a=1;if(fullListUl=document.getElementById("fullList"),!fullListUl)return;fullListUl.innerHTML="";const s=[];for(let l=0;l<e.items.length;l++){const i=e.items[l];if(i.subsets.includes("latin")){let e=[],r="";if(i.variants.length>1){let t=[];for(let n=0;n<i.variants.length;n++){const o=i.variants[n],a=o.includes("italic")?"italic":"normal",s=o.replace(/\D/g,""),l=s||"400";e.includes(l)||e.push(l);const r=weightNames[l]||"";t.push({fontWeight:l,fontStyle:a,namedWeight:r})}r=JSON.stringify(t)}const c=e.join(),d=1===i.variants.length?"selectable":"hasVariants",u=i.category.toLowerCase(),m=`\n            <li\n                data-font-name="${i.family}"\n                data-font-weight="400"\n                data-variant-weights="${c}"\n                data-font-index="${l}"\n                data-category="${u}"\n                data-lowercase="${i.family.toLowerCase()}"\n                class="${d} icon parent"\n                style="font-family:'${i.family}'"\n            >\n                <span class="fontName familyName">${i.family}</span>\n                <favorite-heart data-font-name="${i.family}"></favorite-heart>\n                <span class="fontStyles">\n                    ${i.variants.length} ${1===i.variants.length?"style":"styles"}\n                </span>\n                <div class="variants" ${i.variants.length>1?"data-variants='"+r+"'":""}>\n                </div>\n            </li>`;fullListUl.insertAdjacentHTML("beforeend",m),s.includes(u)||s.push(u);if(t+=(1===o?"?":"&")+"family="+encodeURIComponent(i.family),50===o){createFontStyles(n+t,a),t="",o=0,a++}o++}}if(o>0&&t){createFontStyles(n+t,a)}createFilterOptions(weightNames,"weight","weights"),createFilterOptions(s.sort(),"category","categories"),restoredState&&(document.getElementById("searchInput")&&(document.getElementById("searchInput").value=restoredState.searchInput||""),document.getElementById("categoryFilter")&&(document.getElementById("categoryFilter").value=restoredState.categoryFilter||"none"),document.getElementById("weightFilter")&&(document.getElementById("weightFilter").value=restoredState.weightFilter||"none"),document.getElementById("selectorInput")&&(document.getElementById("selectorInput").value=restoredState.selectorInput||""),document.getElementById("selectorInputBottom")&&(document.getElementById("selectorInputBottom").value=restoredState.selectorInput||"")),setupFontObserver(),loadFavoritesList(),updateFilter().then((()=>{restoredState&&restoredState.topVisibleFont&&restoreTopFont()})).then((()=>{hidePreloader()}))}function setupFontObserver(){fullListUl&&(fontObserver=new IntersectionObserver(((e,t)=>{e.forEach((e=>{e.isIntersecting&&setTimeout((()=>{const n=e.target.getBoundingClientRect();if(n.bottom<0||n.top>window.innerHeight)return;const o=e.target,a=o.getAttribute("data-font-index");if(a){const e=parseInt(a,10);activateFontStyles(Math.floor(e/50)+1);const n=o.getAttribute("data-font-name");if(n){const e=document.querySelector(`link[data-immediate="${n}"]`);if(e&&""===e.getAttribute("href")){const t=e.getAttribute("data-url");e.href=t}}t.unobserve(o)}}),100)}))}),{threshold:0}),fullListUl.querySelectorAll("li:not(.loaded)").forEach((e=>{fontObserver.observe(e)})))}function activateBatch(e){const t=document.querySelector(`link[data-index="${e}"]`);if(t&&""===t.getAttribute("href")){const n=t.getAttribute("data-url");t.href=n,t.onload=()=>{const t=performance.getEntriesByName(n);if(t&&t.length>0){0===t[0].transferSize?console.log(`Font batch ${e} loaded from cache.`):console.log(`Font batch ${e} loaded from network.`)}else console.log(`Font batch ${e} loaded.`)};const o=50,a=fullListUl.querySelectorAll("li");for(let t=(e-1)*o;t<e*o;t++)a[t]&&a[t].classList.add("loaded")}}function activateFontStyles(e){activateBatch(e-1),activateBatch(e),activateBatch(e+1),activateBatch(e+2)}function createFontStyles(e,t){const n=document.createElement("link");n.rel="stylesheet",n.type="text/css",n.setAttribute("data-index",t),n.setAttribute("data-url",e),n.href="",document.head.appendChild(n)}function createFilterOptions(e,t,n){let o=`<option value='none'>All ${toTitleCase(n)}</option>`;if(Array.isArray(e))e.forEach((e=>{o+="category"===t?`<option value='${e.toLowerCase()}'>${toTitleCase(e)}</option>`:`<option value='${e}'>${toTitleCase(e)}</option>`}));else for(let n in e)e.hasOwnProperty(n)&&(o+="category"===t?`<option value='${n.toLowerCase()}'>${toTitleCase(e[n])}</option>`:`<option value='${n}'>${toTitleCase(e[n])}</option>`);const a=document.getElementById("weight"===t?"weightFilter":"categoryFilter");a&&(a.innerHTML=o)}function loadFavoritesList(){chrome.storage.local.get("favorite-fonts",(e=>{const t=e["favorite-fonts"]||[];void 0!==t&&t.forEach((e=>{document.querySelectorAll(`li[data-font-name='${e}'] favorite-heart`).forEach((e=>{e.setAttribute("data-favorited","true")}));const t=document.querySelector(`li.parent[data-font-name='${e}']`);if(t){const e=t.cloneNode(!0);e.style.display="",e.classList.remove("open");const n=document.getElementById("favoritesList");n&&n.appendChild(e)}}))}))}function updateFavoritesList(){const e=[];fullListUl.querySelectorAll("li").forEach((t=>{if(t.querySelector("favorite-heart[data-favorited='true']")){const n=t.querySelector("span.fontName");n&&e.push(n.textContent)}})),setStorageData("favorite-fonts",e),updateBadgeCounts()}function updateSelectedFonts(e,t,n,o,a="",s="px"){let l=[];const i=document.querySelector(`li.parent[data-font-name="${t}"]`);if(i){const e=i.getAttribute("data-variant-weights");e&&(l=e.split(","))}0===l.length&&(l=[n]),selectedFonts[e]={fontFamily:t,fontWeight:n,fontStyle:o,fontSize:a,fontSizeUnit:s,availableWeights:l},updateSelectedList(),chrome.storage.local.set({["selectedFonts_"+currentDomain]:selectedFonts}),document.getElementById("keepAppliedCheckbox").checked&&reapplySelectedFonts()}function updateSelectedList(){const e=document.getElementById("selectedFontsList");if(e){e.innerHTML="";for(let t in selectedFonts){if(!selectedFonts.hasOwnProperty(t))continue;const{fontFamily:n,fontWeight:o,fontStyle:a,fontSize:s,fontSizeUnit:l}=selectedFonts[t],i=document.createElement("div");i.classList.add("selectedFontContainer");const r=document.createElement("div");r.classList.add("selectedFontRowTop");const c=document.createElement("span");c.classList.add("selectorCell"),c.textContent="*"===t?"all":t,c.style.flex="1",r.appendChild(c);const d=document.createElement("div");d.classList.add("controlsContainer"),d.style.marginLeft="auto",d.style.display="flex",d.style.alignItems="center",d.style.gap="10px";const u=document.createElement("span");u.classList.add("fontWeightCell");const m=selectedFonts[t].availableWeights||[o],f=document.createElement("select");f.classList.add("fontWeightSelect"),f.classList.add("selectedSelect"),f.setAttribute("autocomplete","off"),1===m.length&&(f.classList.add("single-option"),f.setAttribute("disabled","disabled")),m.forEach((e=>{const t=document.createElement("option");t.value=e,t.textContent=weightNames[e]||e,e===o&&(t.selected=!0),f.appendChild(t)})),f.addEventListener("change",(function(){selectedFonts[t].fontWeight=this.value,chrome.storage.local.set({["selectedFonts_"+currentDomain]:selectedFonts}),reapplySelectedFonts(),C.style.fontWeight=this.value})),u.appendChild(f),d.appendChild(u);const p=document.createElement("span");p.classList.add("fontOptionsCell");const g=document.createElement("select");g.classList.add("fontOptionsSelect"),g.classList.add("selectedSelect"),g.setAttribute("autocomplete","off");[{value:"normal",label:"Normal"},{value:"italic",label:"Italic"},{value:"underline",label:"Underline"},{value:"lowercase",label:"Lowercase"},{value:"uppercase",label:"Uppercase"}].forEach((e=>{const t=document.createElement("option");t.value=e.value,t.textContent=e.label,"normal"===e.value&&(t.selected=!0),g.appendChild(t)})),g.addEventListener("change",(function(){const e=this.value;"italic"===e?(selectedFonts[t].extraFontStyle="italic",delete selectedFonts[t].textDecoration,delete selectedFonts[t].textTransform,C.style.fontStyle="italic",C.style.textDecoration="",C.style.textTransform=""):"underline"===e?(selectedFonts[t].textDecoration="underline",delete selectedFonts[t].extraFontStyle,delete selectedFonts[t].textTransform,C.style.textDecoration="underline",C.style.fontStyle="",C.style.textTransform=""):"lowercase"===e?(selectedFonts[t].textTransform="lowercase",delete selectedFonts[t].extraFontStyle,delete selectedFonts[t].textDecoration,C.style.textTransform="lowercase",C.style.fontStyle="",C.style.textDecoration=""):"uppercase"===e?(selectedFonts[t].textTransform="uppercase",delete selectedFonts[t].extraFontStyle,delete selectedFonts[t].textDecoration,C.style.textTransform="uppercase",C.style.fontStyle="",C.style.textDecoration=""):(delete selectedFonts[t].extraFontStyle,delete selectedFonts[t].textDecoration,delete selectedFonts[t].textTransform,C.style.fontStyle="",C.style.textDecoration="",C.style.textTransform=""),chrome.storage.local.set({["selectedFonts_"+currentDomain]:selectedFonts}),reapplySelectedFonts()})),p.appendChild(g),d.appendChild(p);const h=document.createElement("span");h.classList.add("fontSizeCell");const y=document.createElement("input");y.type="text",y.inputMode="numeric",y.classList.add("fontSize"),y.placeholder="Size",y.value=s||"",y.setAttribute("autocomplete","off"),y.setAttribute("autocorrect","off"),y.setAttribute("autocapitalize","off"),y.setAttribute("spellcheck","false"),y.addEventListener("change",(function(){selectedFonts[t].fontSize=this.value,chrome.storage.local.set({["selectedFonts_"+currentDomain]:selectedFonts}),reapplySelectedFonts()})),h.appendChild(y);const v=document.createElement("select");v.classList.add("fontSizeUnit"),v.setAttribute("autocomplete","off"),["px","pt","em","rem","%"].forEach((e=>{const t=document.createElement("option");t.value=e,t.textContent=e,e===l&&(t.selected=!0),v.appendChild(t)})),v.addEventListener("change",(function(){selectedFonts[t].fontSizeUnit=this.value,chrome.storage.local.set({["selectedFonts_"+currentDomain]:selectedFonts}),reapplySelectedFonts()})),h.appendChild(v),d.appendChild(h);const S=`<span class='heartCell'><favorite-heart data-font-name='${n}'></favorite-heart></span>`;d.insertAdjacentHTML("beforeend",S);const F="https://fonts.google.com/specimen/"+encodeURIComponent(n.replace(/\s+/g,"+")),E=document.createElement("span");E.classList.add("linkCell"),E.innerHTML=`\n        <a href="${F}" target="_blank" title="View in Google Fonts" style="display: inline-block;">\n            <svg width="20" height="20" viewBox="0 0 24 24" fill-rule="evenodd" clip-rule="evenodd"><path d="M14.851 11.923c-.179-.641-.521-1.246-1.025-1.749-1.562-1.562-4.095-1.563-5.657 0l-4.998 4.998c-1.562 1.563-1.563 4.095 0 5.657 1.562 1.563 4.096 1.561 5.656 0l3.842-3.841.333.009c.404 0 .802-.04 1.189-.117l-4.657 4.656c-.975.976-2.255 1.464-3.535 1.464-1.28 0-2.56-.488-3.535-1.464-1.952-1.951-1.952-5.12 0-7.071l4.998-4.998c.975-.976 2.256-1.464 3.536-1.464 1.279 0 2.56.488 3.535 1.464.493.493.861 1.063 1.105 1.672l-.787.784zm-5.703.147c.178.643.521 1.25 1.026 1.756 1.562 1.563 4.096 1.561 5.656 0l4.999-4.998c1.563-1.562 1.563-4.095 0-5.657-1.562-1.562-4.095-1.563-5.657 0l-3.841 3.841-.333-.009c-.404 0-.802.04-1.189.117l4.656-4.656c.975-.976 2.256-1.464 3.536-1.464 1.279 0 2.56.488 3.535 1.464 1.951 1.951 1.951 5.119 0 7.071l-4.999 4.998c-.975.976-2.255 1.464-3.535 1.464-1.28 0-2.56-.488-3.535-1.464-.494-.495-.863-1.067-1.107-1.678l.788-.785z"/></svg>\n        </a>`,d.appendChild(E);const L=document.createElement("span");L.title="Unapply Font",L.classList.add("removeCell"),L.innerHTML='<svg width="20" height="20" viewBox="0 0 24 24" fill-rule="evenodd" clip-rule="evenodd"><path d="M12 0c6.623 0 12 5.377 12 12s-5.377 12-12 12-12-5.377-12-12 5.377-12 12-12zm0 1c6.071 0 11 4.929 11 11s-4.929 11-11 11-11-4.929-11-11 4.929-11 11-11zm0 10.293l5.293-5.293.707.707-5.293 5.293 5.293 5.293-.707.707-5.293-5.293-5.293 5.293-.707-.707 5.293-5.293-5.293-5.293.707-.707 5.293 5.293z" /></svg>',L.addEventListener("click",(function(e){e.stopPropagation(),chrome.tabs.query({active:!0,currentWindow:!0},(e=>{e[0];selectedCSS[t]?removeInjectedFontStyle(t,(()=>{delete selectedFonts[t],delete selectedCSS[t],updateSelectedList(),chrome.storage.local.set({["selectedFonts_"+currentDomain]:selectedFonts})})):(delete selectedFonts[t],updateSelectedList(),chrome.storage.local.set({["selectedFonts_"+currentDomain]:selectedFonts}))})),updatePersistentState()})),d.appendChild(L),r.appendChild(d);const b=document.createElement("div");b.classList.add("selectedFontRowBottom");const C=document.createElement("span");C.classList.add("fontNameCell"),C.textContent=n,C.style.fontFamily=n,C.style.fontWeight=o,b.appendChild(C),i.appendChild(r),i.appendChild(b),e.appendChild(i),updateBadgeCounts()}}}function appendTargetPage(e,t,n,o,a="",s="px"){let l=document.getElementById("selectorInput").value;l||(l="*"),fetch(t).then((e=>e.text())).then((t=>{chrome.tabs.query({active:!0,currentWindow:!0},(i=>{const r=i[0],c=buildCustomCss(wrapSelector(l),e,n,o,a,s),d=t+c,u=getStyleId(l);chrome.scripting.executeScript({target:{tabId:r.id},func:(e,t)=>{let n=document.getElementById(t);n||(n=document.createElement("style"),n.id=t,document.head.appendChild(n)),n.textContent=e,document.documentElement.classList.add("previewerForGoogleFonts")},args:[d,u]}),selectedCSS[l]=u}))})).catch((e=>console.error(e)))}function loadVariantStyles(e){if(!e)return;const t=e.querySelector("div.variants");if(!t||t.classList.contains("loaded"))return;if(!t.querySelector("li")&&t.getAttribute("data-variants"))try{const n=JSON.parse(t.getAttribute("data-variants"));let o="<ul>";n.forEach((t=>{const n=e.getAttribute("data-font-name");o+=`\n            <li\n              data-font-name="${n}"\n              data-font-weight="${t.fontWeight}"\n              data-font-style="${t.fontStyle}"\n              class="selectable variant icon"\n              style="font-weight:${t.fontWeight}; font-style:${t.fontStyle};"\n            >\n              <span class="fontName" style="font-family:'${n}'">${n}</span>\n              <span class="fontStyles">${t.namedWeight} ${t.fontWeight} ${"italic"===t.fontStyle?"Italic":""}</span>\n            </li>`})),o+="</ul>",t.innerHTML=o}catch(e){console.error("Error parsing variant data",e)}const n=e.querySelector("span.familyName")?.textContent;if(n){let o="https://fonts.googleapis.com/css2?family="+encodeURIComponent(n)+":ital,wght@";const a=[];e.querySelectorAll("div.variants li").forEach((e=>{const t="italic"===e.getAttribute("data-font-style")?1:0,n=e.getAttribute("data-font-weight");a.push(t+n+"|"+t+","+n)})),a.sort();let s=!0;a.forEach((e=>{const t=e.split("|")[1];s||(o+=";"),o+=t,s=!1}));const l=document.createElement("link");l.rel="stylesheet",l.type="text/css",l.href=o,document.head.appendChild(l),t.classList.add("loaded")}}document.addEventListener("DOMContentLoaded",(()=>{document.getElementById("tabFind").classList.add("active"),document.getElementById("findSection").classList.add("active"),document.getElementById("selectedSection").classList.remove("active"),document.getElementById("favoritesSection").classList.remove("active"),chrome.tabs.query({active:!0,currentWindow:!0},(e=>{const t=e[0].url,n=new URL(t);currentDomain=n.host;const o=document.getElementById("selectedHeader");o&&(o.textContent=currentDomain),chrome.storage.local.get(["selectedFonts_"+currentDomain,"keepApplied_"+currentDomain,"popupState_"+currentDomain],(e=>{selectedFonts=e["selectedFonts_"+currentDomain]||{};const t=e["keepApplied_"+currentDomain];updateSelectedList();const n=document.getElementById("keepAppliedCheckbox");n&&(n.checked=!0===t),Object.keys(selectedFonts).length>0&&reapplySelectedFonts();const o=e["popupState_"+currentDomain];o&&(restoredState=o)}))})),RequestFontsJSON();const e=document.getElementById("searchInput"),t=document.getElementById("categoryFilter"),n=document.getElementById("weightFilter"),o=document.getElementById("selectorInput"),a=(document.getElementById("favoritesList"),document.getElementById("keepAppliedCheckbox"));e&&e.addEventListener("keyup",runFilterChain),t&&t.addEventListener("change",runFilterChain),n&&n.addEventListener("change",runFilterChain),o&&o.addEventListener("change",(()=>{const e=document.getElementById("selectorInputBottom");e&&(e.value=o.value),updatePersistentState()}));const s=document.getElementById("selectorInputBottom");s&&s.addEventListener("change",(()=>{const e=document.getElementById("selectorInput");e&&(e.value=s.value),updatePersistentState()})),a&&a.addEventListener("change",(()=>{chrome.storage.local.set({["keepApplied_"+currentDomain]:a.checked})})),document.addEventListener("favorite-toggle",(e=>{e.stopPropagation();const{favorited:t,fontName:n}=e.detail;document.querySelectorAll(`favorite-heart[data-font-name="${n}"]`).forEach((e=>{"function"==typeof e.setFavorited?e.setFavorited(t):e.setAttribute("data-favorited",t)}));const o=document.getElementById("favoritesList");if(t){if(!document.querySelector(`ul.favorites li[data-font-name="${n}"]`)){const e=document.querySelector(`ul.full-list li.parent[data-font-name="${n}"]`);if(e){const t=e.cloneNode(!0),n=t.querySelector("favorite-heart");n&&n.setAttribute("data-favorited","true"),o&&(o.appendChild(t),o.querySelectorAll("li").forEach((e=>{e.classList.remove("open")})))}}}else document.querySelectorAll(`ul.favorites li[data-font-name="${n}"]`).forEach((e=>{e.remove()}));updateFavoritesList(),updatePersistentState()})),document.addEventListener("click",(e=>{if(e.target.closest("#selectedFontsList"))return;const t=e.target.closest("li");if(t){if(e.stopPropagation(),t.classList.contains("selectable")){const e=t.closest("div.scroller");if(t.classList.contains("variant")||e&&!e.classList.contains("weightFiltered"))if(t.classList.contains("selected"))t.classList.remove("selected");else{const e="https://fonts.googleapis.com/css2?family=",n=t.getAttribute("data-font-name");let a=e+encodeURIComponent(n)+":ital,wght@";const s=t.getAttribute("data-font-weight"),l=t.getAttribute("data-font-style");a+=("italic"===l?1:0)+","+s;const i=(o?o.value.trim():"")||"*";appendTargetPage(n,a,s,l,"","px"),updateSelectedFonts(i,n,s,l,"","px")}}else{const e=t.closest("div.scroller");if(e&&!e.classList.contains("weightFiltered")&&(t.classList.toggle("open"),t.classList.contains("open"))){const e=t.querySelector("div.variants");e&&!e.classList.contains("loaded")&&loadVariantStyles(t)}}updatePersistentState()}})),document.querySelectorAll("div.tabs > div").forEach((e=>{e.addEventListener("click",(function(){document.querySelectorAll("div.tabs > div").forEach((e=>{e.classList.remove("active")})),this.classList.add("active"),"tabFind"===this.id?(document.getElementById("findSection").classList.add("active"),document.getElementById("selectedSection").classList.remove("active"),document.getElementById("favoritesSection").classList.remove("active")):"tabSelected"===this.id?(document.getElementById("selectedSection").classList.add("active"),document.getElementById("findSection").classList.remove("active"),document.getElementById("favoritesSection").classList.remove("active")):"tabFavorites"===this.id&&(document.getElementById("favoritesSection").classList.add("active"),document.getElementById("findSection").classList.remove("active"),document.getElementById("selectedSection").classList.remove("active")),updatePersistentState()}))})),document.querySelectorAll(".clearAll").forEach((e=>{e.addEventListener("click",(function(){if(confirm("Clear everything from the extension cache?")){const e=this.closest("div.field"),t=e?e.querySelector("p.success"):null;chrome.storage.local.clear((()=>{t&&(t.style.display="block",setTimeout((()=>{t.style.display="none"}),2e3))}))}}))}));const l=document.querySelector("#findSection .scroller.filterable");l&&l.addEventListener("scroll",updatePersistentState);const i=document.querySelector("#selectedSection .scroller");i&&i.addEventListener("scroll",updatePersistentState);const r=document.querySelector("#favoritesSection .scroller");r&&r.addEventListener("scroll",updatePersistentState),chrome.storage.onChanged.addListener(((e,t)=>{"local"===t&&(e["favorite-fonts"]||e[`selectedFonts_${currentDomain}`])&&updateBadgeCounts()}))}));class Heart extends HTMLElement{constructor(){super(),this.innerHTML=`\n        <div class="icon-heart" data-font-name="${this.getAttribute("data-font-name")||""}" title="Favorites">\n          <svg class="heart unfilled" width="20" height="20" viewBox="0 0 24 24">\n            <path d="M12 21.593c-5.63-5.539-11-10.297-11-14.402 0-3.791 3.068-5.191 5.281-5.191 1.312 0 4.151.501 5.719 4.457 1.59-3.968 4.464-4.447 5.726-4.447 2.54 0 5.274 1.621 5.274 5.181 0 4.069-5.136 8.625-11 14.402m5.726-20.583c-2.203 0-4.446 1.042-5.726 3.238-1.285-2.206-3.522-3.248-5.719-3.248-3.183 0-6.281 2.187-6.281 6.191 0 4.661 5.571 9.429 12 15.809 6.43-6.38 12-11.148 12-15.809 0-4.011-3.095-6.181-6.274-6.181"/>\n          </svg>          \n          <svg class="heart filled" width="20" height="20" viewBox="0 0 24 24">\n            <path d="M 6.28125,1.9992187 C 4.0193461,1.9624295 1.6750342,3.4418436 1.171875,5.7304687 0.54964202,8.0153755 1.6764534,10.283588 2.9976562,12.091406 5.6040962,15.60959 8.9188062,18.508006 12,21.592969 15.126822,18.446884 18.515037,15.506536 21.140625,11.90625 22.424119,10.128909 23.444094,7.881274 22.809375,5.6625 22.302439,3.4886766 20.130536,2.0503875 17.964844,2.015625 15.575692,1.8740863 13.389821,3.486968 12.39375,5.5898437 12.152087,6.0429493 11.98298,6.8365546 11.770312,5.9226562 10.826218,3.7285173 8.7655942,1.9629425 6.28125,1.9992187 Z M 17.726,1.01 C 15.523,1.01 13.28,2.052 12,4.248 10.715,2.042 8.478,1 6.281,1 3.098,1 0,3.187 0,7.191 0,11.852 5.571,16.62 12,23 18.43,16.62 24,11.852 24,7.191 24,3.18 20.905,1.01 17.726,1.01" />\n          </svg>\n        </div>\n      `}connectedCallback(){const e=this.getAttribute("data-font-name")||"";chrome.storage.local.get("favorite-fonts",(t=>{const n=(t["favorite-fonts"]||[]).includes(e);this.setFavorited(n)})),this.addEventListener("click",this.toggleFavorite.bind(this))}disconnectedCallback(){this.removeEventListener("click",this.toggleFavorite.bind(this))}toggleFavorite(e){e.stopPropagation();const t=!("true"===this.getAttribute("data-favorited")),n=this.getAttribute("data-font-name")||"";chrome.storage.local.get("favorite-fonts",(e=>{let o=e["favorite-fonts"]||[];t?o.includes(n)||o.push(n):o=o.filter((e=>e!==n)),chrome.storage.local.set({"favorite-fonts":o},(()=>{this.setFavorited(t),this.dispatchEvent(new CustomEvent("favorite-toggle",{bubbles:!0,detail:{favorited:t,fontName:n}}))}))}))}setFavorited(e){this.setAttribute("data-favorited",String(e));const t=this.querySelector("svg.filled"),n=this.querySelector("svg.unfilled");e?(t&&(t.style.display="inline-block"),n&&(n.style.display="none")):(t&&(t.style.display="none"),n&&(n.style.display="inline-block"))}}customElements.define("favorite-heart",Heart);